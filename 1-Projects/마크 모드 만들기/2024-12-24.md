	오늘은 퀘스트 State머신을 구현했다. 지난 개발동안 퀘스트를 주고받고 하는 과정에서 생기는 오류를 해결하기 위해 약간의 전역변수 설정과 메커니즘을 바꾸어 보았다.

![[Pasted image 20241224020939.png]]
퀘스트가 있는지 확인을 위한 Main,SubQuestExist 변수, 퀘스트를 주는 npc를 우클릭했을 때, Quest Request를 발생시키는 변수, Reward 조건이 충족되었을 때 Request를 발생시키는 변수로 두가지 Request와 한가지 변수로 구성하였다.

Request의 경우 특정 상황에만 True가 되는 방식으로 요청이 있는 지 없는 지 확인하는 트리거 역할을 수행한다. GUI를 열때  Request의 상태에 따라 다른 GUI를 보여주도록 만들었고, 창이 닫힐때는 요청을 False로 두어 초기화 해주었다. 

![[Pasted image 20241224042535.png]]
퀘스트를 주는 NPC는 다음과 같이 퀘스트의 유무, 완료 여부에 따라 Request를 보내고 해당 Request에 맞는 GUI를 열게 된다.
![[Pasted image 20241224042718.png]]
GUI에서는 다음과 같이 상태를 확인한 뒤 상태에 맞는 행위를 수행한 뒤 Request를 False로 되돌려 놓는다. 이렇게 하면 다른 NPC와의  퀘스트와 겹치지 않으면서, 유저의 퀘스트 진행 상태와 싱크를 맞출 수 있다.

![[Pasted image 20241224042941.png]]
GUI는 메인퀘스트와 서브퀘스트가 있을때만 표시되도록 설정하고, 있다면 진행도와 완료되었을 때 완료 표시가 뜨도록 설계했다.

다음으로 할 일은 보상 관련 설계인데, 주 보상 내용이 돈이기 때문에 화폐시스템을 먼저 만들기로 한다.
화폐시스템을 만든 뒤, 보상기능을 추가하고, 다양한 종류의 퀘스트를 만들어보자.
